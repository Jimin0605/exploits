from Crypto.Util.Padding import pad, unpad
from Crypto.Cipher import AES
from pwn import *

encrypt = lambda pt: AES.new(key, AES.MODE_CBC, key).encrypt(pad(pt, 16))
decrypt = lambda ct: unpad(AES.new(key, AES.MODE_CBC, key).decrypt(ct), 16)

r = remote("srv1.kitriwhs.kr", 19247)

r.sendlineafter("[3] Get Flag\n", "1")
r.sendlineafter("(hex): ", "00" * 16)
blk = bytes.fromhex(r.recvline(keepends=False).decode())
print(blk)

r.sendlineafter("[3] Get Flag\n", "2")
r.sendlineafter("(hex): ", "00" * 16 + blk.hex())

key = bytes.fromhex(r.recvline(keepends=False).decode())[16:32]
print(key)

r.sendlineafter("[3] Get Flag\n", "3")
r.recvuntil("flag = ")
ct = bytes.fromhex(r.recvline(keepends=False).decode())
print(ct)

print(decrypt(ct))